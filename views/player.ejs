<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Player</title>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/artplayer/dist/artplayer.css">
  
  <style>
    html, body { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; background: #000; }
    #player-container {
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    iframe { border: none; width: 100%; height: 100%; }
    .art-progress-highlight span { background: red !important; width: 15px !important; }
    #loading-screen { 
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: black; z-index: 1000; display: flex; 
        justify-content: center; align-items: center; 
    }
  </style>
</head>
<body>
  
  <div id="loading-screen">
    <img src="/loader.svg" alt="Loading" width="50">
  </div>

  <div id="player-container"></div>

  <script src="https://cdn.jsdelivr.net/npm/artplayer/dist/artplayer.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/artplayer-plugin-vast@1.0.0/dist/artplayer-plugin-vast.min.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      try {
        const params = new URLSearchParams(window.location.search);
        const encodedUrl = params.get('url');
        const encodedTitle = params.get('title');
        const encodedPoster = params.get('poster');

        if (!encodedUrl) throw new Error('URL video tidak ditemukan');

        // Decode Base64
        const decodedUrl = atob(encodedUrl);
        const decodedTitle = encodedTitle ? decodeURIComponent(encodedTitle) : 'Nonton Video';
        const decodedPoster = encodedPoster ? decodeURIComponent(encodedPoster) : '/images/default.jpg';
        
        // --- DETEKSI TIPE KONTEN ---
        // Cek ekstensi file untuk menentukan apakah pakai Artplayer atau Iframe biasa
        const isDirectVideo = /\.(mp4|m3u8|mkv|webm)(\?|$)/i.test(decodedUrl);

        if (isDirectVideo) {
            // Mode A: Direct Video -> Pakai Artplayer
            initializeArtPlayer(decodedUrl, decodedTitle, decodedPoster);
        } else {
            // Mode B: Embed/Website Lain -> Pakai Iframe Biasa
            initializeIframe(decodedUrl);
        }

      } catch (e) {
        console.error('Gagal memuat player:', e);
        document.getElementById('loading-screen').style.display = 'none';
        document.getElementById('player-container').innerHTML =
          `<p style="color: red; text-align: center;">Gagal memuat video: ${e.message}</p>`;
      }
    });

    // --- FUNGSI 1: Render Iframe (Untuk Vidhide, Desustream, dll) ---
    function initializeIframe(url) {
        const container = document.getElementById('player-container');
        // Buat elemen iframe
        const iframe = document.createElement('iframe');
        iframe.src = url;
        iframe.setAttribute('allowfullscreen', 'true');
        iframe.setAttribute('allow', 'autoplay; encrypted-media; picture-in-picture');
        iframe.setAttribute('scrolling', 'no');
        
        container.innerHTML = ''; // Bersihkan container
        container.appendChild(iframe);

        // Hilangkan loading screen saat iframe mulai dimuat
        // (Note: event onload iframe tidak selalu akurat karena cross-origin, jadi kita set timeout safety)
        iframe.onload = function() {
             document.getElementById('loading-screen').style.display = 'none';
        };
        setTimeout(() => {
             document.getElementById('loading-screen').style.display = 'none';
        }, 2000); // Fallback 2 detik
    }

    // --- FUNGSI 2: Render Artplayer (Untuk file .mp4, .m3u8 langsung) ---
    function initializeArtPlayer(videoUrl, episodeTitle, posterUrl) {
      // Hilangkan loading screen segera karena Artplayer punya loader sendiri
      document.getElementById('loading-screen').style.display = 'none';

      const art = new Artplayer({
        container: '#player-container',
        url: videoUrl,
        title: episodeTitle,
        poster: posterUrl,
        volume: 0.7,
        isLive: false,
        muted: false,
        autoplay: false, // Browser modern memblokir autoplay dengan suara
        autoMini: true,
        setting: true,
        loop: false,
        flip: true,
        playbackRate: true,
        aspectRatio: true,
        fullscreen: true,
        miniProgressBar: true,
        playsInline: true,
        autoPlayback: true,
        
        // Custom Icons
        icons: {
          loading: '<img src="/loader.svg" alt="Loading" style="width: 35px; height: 35px;">',
          state: '<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24"><path fill="#FFF" d="M9.5 9.325v5.35q0 .575.525.875t1.025-.05l4.15-2.65q.475-.3.475-.85t-.475-.85L11.05 8.5q-.5-.35-1.025-.05t-.525.875M12 22q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12t.788-3.9 2.137-3.175q1.35-1.35 3.175-2.137T12 2t3.9.788 3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22"></path></svg>',
        },
        
        // Bahasa Indonesia
        i18n: {
          'id': {
              'Video Load Failed': 'Gagal memuat video',
              'Reconnect': 'Menghubungkan Kembali',
              'Show Setting': 'Setelan',
              'Fullscreen': 'Layar Penuh',
              'Play': 'Putar',
              'Pause': 'Jeda',
              'Play Speed': 'Kecepatan',
              'Aspect Ratio': 'Rasio Aspek',
              'Video Flip': 'Rotasi Video',
              'Default': 'Bawaan',
          },
        },
        lang: 'id',

        // Matikan Context Menu Klik Kanan
        contextmenu: [],

        // Tombol Kontrol Tambahan
        controls: [
          {
            position: 'right',
            html: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 240 240"><path fill="#fff" d="M113.2 131.078a21.589 21.589 0 0 0-17.7-10.6 21.589 21.589 0 0 0-17.7 10.6 44.769 44.769 0 0 0 0 46.3 21.589 21.589 0 0 0 17.7 10.6 21.589 21.589 0 0 0 17.7-10.6 44.769 44.769 0 0 0 0-46.3Zm-17.7 47.2c-7.8 0-14.4-11-14.4-24.1s6.6-24.1 14.4-24.1 14.4 11 14.4 24.1-6.5 24.1-14.4 24.1Zm-43.4 9.7v-51l-4.8 4.8-6.8-6.8 13-13a4.8 4.8 0 0 1 8.2 3.4v62.7l-9.6-.1Zm162-130.2v125.3a4.867 4.867 0 0 1-4.8 4.8h-62.7v-19.3h48.2v-96.4H79.1v19.3c0 5.3-3.6 7.2-8 4.3l-41.8-27.9a6.013 6.013 0 0 1-2.7-8 5.887 5.887 0 0 1 2.7-2.7l41.8-27.9c4.4-2.9 8-1 8 4.3v19.3h130.1a4.974 4.974 0 0 1 4.9 4.9Z"></path></svg>',
            tooltip: '-10 Detik',
            click: function() { art.backward = 10; },
          },
          {
            position: 'right',
            html: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 240 240"><path fill="#fff" d="M25.994 57.778v125.3a4.867 4.867 0 0 0 4.8 4.8h62.7v-19.3h-48.2v-96.4h115.7v19.3c0 5.3 3.6 7.2 8 4.3l41.8-27.9a6.013 6.013 0 0 0 2.7-8 5.887 5.887 0 0 0-2.7-2.7l-41.8-27.9c-4.4-2.9-8-1-8 4.3v19.3h-130.1a4.974 4.974 0 0 0-4.9 4.9zm163.422 73.046a21.589 21.589 0 0 0-17.7-10.6 21.589 21.589 0 0 0-17.7 10.6 44.769 44.769 0 0 0 0 46.3 21.589 21.589 0 0 0 17.7 10.6 21.589 21.589 0 0 0 17.7-10.6 44.769 44.769 0 0 0 0-46.3zm-17.7 47.2c-7.8 0-14.4-11-14.4-24.1 0-13.1 6.6-24.1 14.4-24.1 7.8 0 14.4 11 14.4 24.1 0 13.1-6.5 24.1-14.4 24.1zm-47.77 9.728v-51l-4.8 4.8-6.8-6.8 13-13c3.025-3.036 8.21-.886 8.2 3.4v62.7z"></path></svg>',
            tooltip: '+10 Detik',
            click: function() { art.forward = 10; },
          }
        ],
        
        plugins: [
          artplayerPluginVast(({ playUrl }) => {
            art.once('play', () => { 
              // Ganti dengan URL VAST Iklan Anda jika ada, atau hapus plugin ini
              // playUrl('https://vast.yomeno.xyz/vast?spot_id=1450907'); 
            });
          }),
        ],
      });
    }

    // Anti Right Click & Touch Hold
    document.addEventListener("contextmenu", e => e.preventDefault());
    let t = 0;
    document.addEventListener("touchstart", () => { t = Date.now(); });
    document.addEventListener("touchend", e => { if (Date.now() - t > 500) e.preventDefault(); });
  </script>
</body>
</html>
