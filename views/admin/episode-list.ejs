<%- include('../admin/partials/header', { /* data header */ }) %>
<a href="/admin" class="admin-back-btn">« Kembali ke Dasbor</a>
<h1>Admin - Daftar Episode</h1>

<style>
    .admin-back-btn { display: inline-block; margin-bottom: 20px; padding: 6px 12px; background-color: #555; color: #fff !important; border-radius: 4px; font-size: 0.9em; font-weight: bold; text-decoration: none; }
    .admin-back-btn:hover { background-color: #666; text-decoration: none; }
    .admin-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 0.9em;}
    .admin-table th, .admin-table td { border: 1px solid #555; padding: 6px 8px; text-align: left; vertical-align: top;}
    .admin-table th { background-color: #333; }
    .admin-table img { max-height: 50px; width: auto; vertical-align: middle; margin-right: 8px;}
    .admin-table a { color: #87CEEB; }
    .admin-table td:nth-child(2) { max-width: 300px; word-break: break-all; } 
    .admin-table td:nth-child(3) { max-width: 200px; word-break: break-all; } 
    .btn-danger { background-color: #d9534f !important; color: white; border: none; padding: 4px 8px !important; font-size: 0.9em; border-radius: 4px; cursor: pointer; margin-left: 5px; }
</style>

<table class="admin-table">
    <thead>
        <tr>
            <th>Judul Episode</th>
            <th>Slug Episode</th>
            <th>Anime Induk</th>
            <th>Terakhir Update</th>
            <th>Aksi</th>
        </tr>
    </thead>
    <tbody>
       <% episodes.forEach(ep => { %>
            <tr>
                <td><%= ep.title %></td>
                <td><%= ep.episodeSlug %></td>
                <td>
                    <% if (ep.animeSlug) { %>
                        <a href="/anime/<%= encodeURIComponent(ep.animeSlug) %>" target="_blank"><%= ep.animeTitle %></a>
                    <% } else { %>
                        <%= ep.animeTitle || 'N/A' %>
                    <% } %>
                </td>
                <td><%= new Date(ep.updatedAt).toLocaleDateString('id-ID') %></td>
                <td style="white-space: nowrap;">
                    <%# [FIX] Menambahkan "/" pada link Edit %>
                    <a href="/admin/episode/<%= ep.episodeSlug %>/edit">Edit</a>
                     |
                    <%# [FIX] Menambahkan "/" pada link Lihat %>
                    <a href="/episode/<%= ep.episodeSlug %>" target="_blank">Lihat</a>
                    
                    <%# [FIX] Menambahkan "/" pada form Delete %>
                    <form action="/admin/episode/<%= ep.episodeSlug %>/delete" method="POST" style="display: inline-block;" onsubmit="return confirm('Yakin ingin menghapus episode ini? Ini akan menghapusnya dari database.');">
                        <button type="submit" class="btn-danger">Delete</button>
                    </form>
                </td>
            </tr>
        <% }) %>
    </tbody>
</table>

<% if (totalPages > 1) { %>
    <div class="pagination">
      <% if (currentPage > 1) { %> <a href="<%= baseUrl %>?page=<%= currentPage - 1 %>">« Prev</a> <% } else { %> <span class="disabled">« Prev</span> <% } %>
      <% const maxP = 5; let sP = Math.max(1, currentPage - Math.floor(maxP / 2)); let eP = Math.min(totalPages, sP + maxP - 1); if(eP-sP+1<maxP) sP=Math.max(1,eP-maxP+1); %>
      <% if (sP > 1) { %> <a href="<%= baseUrl %>?page=1">1</a> <% if (sP > 2) { %> <span class="disabled">...</span> <% } %> <% } %>
      <% for (let i = sP; i <= eP; i++) { %> <% if (i === currentPage) { %> <span class="current"><%= i %></span> <% } else { %> <a href="<%= baseUrl %>?page=<%= i %>"><%= i %></a> <% } %> <% } %>
      <% if (eP < totalPages) { %> <% if (eP < totalPages - 1) { %> <span class="disabled">...</span> <% } %> <a href="<%= baseUrl %>?page=<%= totalPages %>"><%= totalPages %></a> <% } %>
      <% if (currentPage < totalPages) { %> <a href="<%= baseUrl %>?page=<%= currentPage + 1 %>">Next »</a> <% } else { %> <span class="disabled">Next »</span> <% } %>
    </div>
<% } %>

<%- include('../admin/partials/footer', { page: page }) %>